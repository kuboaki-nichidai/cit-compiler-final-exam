
:linkcss:
:stylesdir: css
:stylesheet: mystyle.css
:twoinches: width='360'
:full-width: width='100%'
:three-quarters-width: width='75%'
:two-thirds-width: width='66%'
:half-width: width='50%'
:half-size:
:one-thirds-width: width='33%'
:one-quarters-width: width='25%'
:thumbnail: width='60'
:imagesdir: images
:sourcesdir: codes
:icons: font
:hide-uri-scheme!:
:figure-caption: 図
:example-caption: リスト
:table-caption: 表
:appendix-caption: 付録
:xrefstyle: short
:section-refsig:
:chapter-refsig:

:sectnums:

= コンパイラ期末試験（cit-compiler-final-exam）

WARNING: 試験実施前に、試験監督より、試験監督要領に基づく試験開始前の受講者への指示をお願いします。また、受講生は同指示に従うこと。


== 試験の概要

[.lead]
これは、コンパイラの期末試験用のAssignmentです。

.関連する学習・教育到達目標
****
. 種々の対象分野において，自動化，効率化，使い勝手の向上等を考慮してソフトウェアの開発ができる。(DP3.3)
. 様々なプログラミング言語の基本的な考え方を理解した上で，個々のソフトウェア開発に適切な言語の選択およびそのプログラミングができる。(DP3.4)
****

[NOTE]
--
画面のスナップショット（またはスクリーンショット、画面やウィンドウのハードコピー）が必要な設問がある。スナップショットの取得方法についてわからない場合には、下記記事等を参考にすること。

https://www.pc-koubou.jp/magazine/35994?srsltid=AfmBOorbVX7AYZLr4Vg7F5Zrp-4U3SbxxGypobX_REF7D-jCkLfKsEw9[Windows スクリーンショットを撮る4つの方法]

--

////
.試験のアナウンス内容
****
* 準備
** lox01のAssignmentを、14回の講義の演習で実施したところまでやってあること
* PC持ち込み、ネットワークも利用可、テキストも持ち込み可
* 試験問題の傾向
** コンパイラ・インタプリタの構成や用語の基礎知識の確認
** Loxのプログラムを作成したインタプリタで動かす
*** 与えられたLoxのプログラムを自分のインタプリタで動かす
** 問題があるインタプリタのエラーを修正する
*** 配布するインタプリタを動かし、エラーの発生箇所を確認する
*** エラーを修正してインタプリタが動くようにする
*** 修正したインタプリタを動かす
** Loxインタプリタに文法を追加する
*** BNFによる文法の定義
*** 追加した文法に合わせてパーサーを変更する
*** 変更したパーサーを使って追加した文法を評価する機能を追加する
*** 更新したインタプリタを動かす
****

////

== 受験の準備

IMPORTANT: 下記準備1、2に指示した記載と、その時点のcommit日時によって、妥当な日時に受験を始めたことを判定するので、後回しにしないこと。

【準備A】このAssignmentのREADME.adoc(この文書）の下記部分を編集し、氏名と学籍番号を記載しなさい。記載したら、一度commitし、pushしておきなさい。

* 氏名: ここに氏名を書く
* 学籍番号: ここに学籍番号を書く


【準備B】各自のlox01を受理したAssignment（lox01-cxxxXXXXXのような名前のフォルダでしょう）のREADME.adocの冒頭の下記箇所を編集して、氏名と学籍番号を記載しなさい。その後、lox01もcommitしてpushしておきなさい。

.lox01（編集前）
[source,asciidoctor]
----
= lox01

[.lead]
Java版Loxを作るための演習用リポジトリです。
----

.lox01（編集後）
[source,asciidoctor]
----
= lox01

[.lead]
Java版Loxを作るための演習用リポジトリです。

* 氏名: ここに氏名を書く
* 学籍番号: ここに学籍番号を書く
----

== コンパイラ・インタプリタの構成や用語の基礎知識の確認（DP3.4）

=== 用語と解説の対応づけ

【問1】下記の用語説明の後の `[用語]` 欄を、このファイル（README.adoc）自体を編集して、ふさわしい用語に修正しなさい。 +
回答は用語群から選びなさい。 +

WARNING: 編集後にプレビューして、期待通り編集できているか確認すること。

.設問
* `javac` コマンドは、Javaソースコードを中間コードに変換する。[用語]
* あるプログラミング言語のソースコードを他のプログラミング言語のソースコードに変換する。[用語]
* 関数の引数や演算の引数が妥当な型なのかチェックする。[用語]
* 式や文に構成する際に、トークンの並びから作成するもの。[用語]
* 終端記号・非終端記号・出発記号・生成規則によってプログラミング言語の構造を表す。[用語]
* ソースコードを実行可能なコードに変換する（実行はしない）。[用語]
* Loxの式や文をを処理するとき利用した処理技法。[用語]
* プログラム中で利用している変数が定義されているかチェックする。[用語]
* 文脈自由文法の生成規則を表現するのに利用する簡便な記法。[用語]
* 文字の並びからトークンの並びに変換する。[用語]

.用語群
.用語群
BNF、Visitor、意味解析、インタプリタ、関数、構文解析、構文木、+
構文規則、コンパイラ、字句解析、構文規則、トランスパイラ、文脈自由文法


.設問と回答の例（Asciidoctorの書式であることに注意）
[source asciidoctor]
----
* この講義の演習で開発対象としたプログラミング言語。[Lox] // <1>

.用語群
Java、Lox
----
<1>  元の表記 `[用語]` を説明にふさわしい用語 `[Lox]` に修正した。

[IMPORTANT]
--
 問1の回答に手を付けたなら、ここで一度commitしなさい（後回しにする、後から修正する場合は、その時にもcommitし直す）。

.commitの例（行頭の `$` はターミナルのプロンプト）
[source,console]
----
$ git commit -m "Answered 2.1" # <1>
または
$ git commit -m "Updated answer for 2.1" # <2>
----
<1> 最初に回答したときのcommitのコメント例
<2> 回答を更新したときのcommitのコメント例
--

=== 生成規則の理解

NOTE: ここで使うBNFの記法は、テキストの記法ではなく、Assignment「lox09」の演習で使った表記であることに注意 +
（コードとしては `codes/breakfast02.bnf` をおいておく）。

【問2】試験範囲（8章、8.4節まで）で作成した状況におけるLox言語の構文規則を、本講義の演習で使用した記法のBNFで示しなさい。 +
BNFは、 `codes/lox_8_4.bnf` に記述し、その結果が「 <<lox_8_4>> 」に反映されていることを確認すること。

[[lox_8_4]]
.8.4節までの構文規則を示したBNF
[source,text]
----
include::{sourcesdir}/lox_8_4.bnf[]
----


【問3】次のBNFで示される言語（Tinyと呼ぼう）を、後述のプログラム例を処理できる言語にしたい。 +
要求に応えられるよう、 `codes/tiny_lang.bnf` を編集しなさい。


.プログラム例
[source,text]
----
x2 = 30;
y3 = 10;
z1 = x2 - y3 * 2;
result = (z1 + 5) / 3;
----

.プログラミング言語TinyのBNF（ `codes/tiny_lang.bnf` ）
[source,text]
----
include::{sourcesdir}/tiny_lang.bnf[]
----

IMPORTANT: 問3の回答に手を付けたなら、一度commitしておきなさい（後でやったり、修正した場合も同様）。


== 作成したLoxインタプリタの動作を確認する（DP3.3）

****
もし、【準備B】をまだ実施していないなら、ここで実施しておくこと。

また、ここから先には、複数のAssignment（cit-complier-final-exam、lox01 など）を扱うので、どのAssignmentのリポジトリを操作するのか注意して臨むこと。
****


=== 試験用のディレクトリを作成する

【準備C】この問題のための試験用ディレクトリを作成しなさい。d

.試験用のディレクトリを用意している例（MSYS2の場合）
[source,console]
----
$ cd /c/Users/kuboaki/ # <1>
$ mkdir compiler-exam # <2>
$ cd compiler-exam # <3>
----
<1> Cドライブのログインユーザー（ここでは `kuboaki` ）ディレクトリをカレントディレクトリにした。
<2> 試験用のディレクトリ（ `compiler-exam` ）を作成した。
<3> 試験用のディレクトリにカレントディレクトリにした。


[TIP]
--
試験用ディレクトリを、他のリポジトリの中に作らないこと。リポジトリの入れ子があると、commitやpushでpermission エラーになることがある。

[source,text]
----
✅️
├ lox01-AAA-BBB # <1>
├ compiler-exam # <2>
----
<1> lox01のAssignmentのリポジトリ。
<2> 試験用のディレクトリを上記Assignmentの並びに作成した（これはよい）。

[source,text]
----
❌️
├ lox01-AAA-BBB # <1>
｜ └ cit-compiler-final-exam-AAA-BBB # <2>
----
<1> lox01のAssignmentのリポジトリ。
<2> 試験用のディレクトリを上記Assignmentのディレクトリ内に作成してしまった（これはまずい）。
--

[[clone01]]
=== lox01をcloneする

【準備D】準備Cで作成した試験用ディレクトリへ、lox01のAssignmentのリポジトリからcloneしなさい。後の問いで、このときの操作を自死した画面のスナップショットを取得するので、操作画面はそのままにしておくこと。

IMPORTANT: 改めてリモート（GitHubサイト）からローカルへcloneすること。ローカル内の既存のlox01のAssignmentのフォルダをコピーして済ませると、あとで試験のために編集した結果をpushするとき問題が生じるが、そのときでは手遅れになる。

.MSYS2でのcloneの様子の例
[source,console]
----
$ pwd
/c/Users/kuboaki/compiler-exam # <1>
$ git clone https://github.com/cit-compiler/lox01-kuboaki-nichidai-1.git # <2>
Cloning into 'lox01-kuboaki-nichidai-1'...
remote: Enumerating objects: 14, done.
remote: Counting objects: 100% (4/4), done.
remote: Compressing objects: 100% (2/2), done.
remote: Total 14 (delta 2), reused 2 (delta 2), pack-reused 10 (from 1)
Receiving objects: 100% (14/14), 19.45 KiB | 9.73 MiB/s, done.
Resolving deltas: 100% (2/2), done.
$ cd lox01-kuboaki-nichidai-1 # <3>
----
<1> `pwd` コマンドを実行し、現在のディレクトリ（ここでは `kuboaki` がログインユーザー名）が、試験用のディレクトリであることを確認した。
<2> このディレクトリにlox01のAssignmentをcloneした。AssignmentのURLは各自で異なることに注意。
<3> cloneしたローカルリポジトリへ移動した。


=== ここまでの作業の様子を保存する

【問4】cloneできた様子を画像ファイルとして取得し、下記ファイル（ `images/cloning_lox01.jpg` ）を置き換えなさい。

NOTE: この文書に差し込んでいる下記ダミーファイルはJPEGファイルになっている。もしPNGファイルに取得したなら、下記で指定しているファイル名の拡張子を変更しなさい。

.作業中のMSYS2ターミナルの様子のスナップショット
--
image::cloning_lox01.jpg[]
--

.上記ファイルへのリンク（このリンクから参照できることを確認する）
link:cloning_lox01.jpg[]

NOTE: 人によってはVSCodeのターミナルペインを使っているかもしれない。その場合には、VSCodeのターミナル部分のスナップショットをとりなさい。

IMPORTANT: ファイル名が、 `cloning_lox01.jpg` になっていることを確認すること。 `cloning_lox01 .jpg` のようにスペースが入っているなど、指示通りのファイル名になっていないと、採点対象にならない・原点される場合がある。

IMPORTANT: 問4の回答に手を付けたなら、一度commitしておきなさい（後でやったり、修正した場合も同様）。

=== lox01の動作を確認する

【問5】試験用ディレクトリにcloneしたlox01に含まれているLoxインタプリタを動かして、動作を示しなさい。

Loxインタプリタの起動から、指定したプログラムを実行しているまでの様子を表示しているターミナルウィンドウのスナップショットを取得しなさい。 +
`sample03.lox` 、 `sample04.lox` のそれぞれについて、下記の指示にあるファイルに保存し、スナップショットが表示されるようにしなさい。

IMPORTANT: もし、最新のlox01が、試験範囲ちょうどの段階の状況でないときは、試験範囲ちょうどの段階のコミットまで戻って実行しなさい。

* `codes/sample03.lox` を lox01の `codes` ディレクトリへコピーして、実行しなさい。

.`sample03.lox` を動作させた様子のスナップショット
--
image::sample03_lox_snap.jpg[]
--

* `codes/sample04.lox` を lox01の `codes` ディレクトリへコピーして、実行しなさい。

.`sample04.lox` を動作させた様子のスナップショット
--
image::sample04_lox_snap.jpg[]
--

IMPORTANT: 問5の回答に手を付けたなら、一度commitしておきなさい（後でやったり、修正した場合も同様）。 +
気になるなら、pushしておくのもよいだろう。

== Loxインタプリタの動作を変更する（DP3.4）

【準備E】 lox01の `codes/com/craftinginterpreters/` にはloxディレクトリがあるが、この `lox` ディレクトリを内容ごとコピーし `lox_s` ディレクトリを作りなさい。

.`lox_s` ディレクトリを作成した状況の例
[source,console]
----
lox01のAssignmentのリポジトリにおいて:
codes/com
├─ craftinginterpreters
│   ├─ lox // <1>
│   │   ├─ Lox.java
│   │   ├─ （などなど）
│   │   └─ TokenType.java
│   └─ lox_s // <2>
│   │   ├─ Lox.java
│   │   ├─ （などなど）
│   │   └─ TokenType.java
（などなど）
----
<1> もとからあった `lox` ディレクトリ。
<2> `lox01` を複製してディレクトリ名を `lox_s` に変更した。

コピーできたら `lox_s` とその中のファイル群がGitHubに認識されるよう、`git add` コマンドですべて追加しておきなさい。

IMPORTANT: `add` を忘れると、push したときに反映されないため、採点対象にならないので注意すること。

【問6】Loxの文字列は「 `"` 」で囲まれた文字の並びであるが、文字列の中には「 `"` 」を含むことができない。 +
そこで、文字列の表記を、開始終了記号は「 `'` 」または「 `"` 」のいずれも利用できるようloxの文法を拡張する。 +
このとき、開始終了記号が「 `'` 」の場合は、文字列に「 `"` 」を含んでいてもよく、開始終了記号が「 `"` 」の場合は、文字列に「 `'` 」を含んでいてもよい。

.文字列の表記を拡張した場合のプログラム例
--
[source,text]
----
print "abcdefg"; // <1>
print 'abc"defg'; // <2>
print "abc'defg"; // <3>
----
<1> これまでの文字列
<2> 今回修正して対応したい文字列の例（1）
<3> 今回修正して対応したい文字列の例（2）
--

. `lox_s` 中のコードを修正して動作できるようにしなさい。
** 修正したメソッドのコードを抽出して、この文書（ `README.adoc` ）の下記の「 <<lox_s_edited_code>> 」に示したブロックを編集して置き換えなさい。
. `lox_s` 中の修正後のLoxインタプリタを動かしなさい。
. 実行時のスナップショットを `images/lox_s_snap.jpg` と差し替えなさい。スナップショットがPNG形式なら、ファイル名の拡張子も変えなさい。

NOTE: 修正や動作確認の途中でも、必要ならcommitしておきなさい。

[[lox_s_edited_code]]
.修正したメソッド
[source, Java]
----
// Parser.java <1>
  private Stmt declaration() { // <2>
    try {
      if (match(VAR)) return varDeclaration();  // <3>

      return statement();
    } catch (ParseError error) {
      synchronize();
      return null;
    }
  }
----
<1> 修正したファイル名をここに書く。
<2> 修正したメソッドの先頭から末尾までを抽出する。
<3> このように、修正箇所がわかるように注釈をつける。

[TIP]
--
上記コードの部分は `----` で囲まれている。
また、行末の1行コメントで `<1>` のような番号をつけておくと、コードブロックのあとに同じ番号を記載してコメントを書ける。
--

.`lox_s` のLoxインタプリタを実行したときのスナップショット
--
image::lox_s_snap.jpg[]
--

IMPORTANT: 問6の回答に手を付けたなら、commitしておきなさい（後でやったり、修正した場合も同様）。 +
気になるなら、pushしておくのもよいだろう。


== プログラムのエラーの修正（DP3.4）

【問7】次のAssignmentのプログラムコードにはエラーがあり、コンパイルが完了しない。
インタプリタが動作するように、エラーを修正し、動作を確認しなさい。

. 次のAssignmentを受理して、試験用のディレクトリに、cloneする。
** `https://classroom.github.com/a/HweuLHTG` （1, 2限目）
** `https://classroom.github.com/a/C9LraX0c` （3, 4限目）
. 受理したAssignmentのプログラムコードにエラーがあり、コンパイルが完了しないことを確認する。
** コンパイルエラーがおきていることがわかるターミナルウィンドウのスナップショットを取得し「 <<lox_e_error>> 」を差し替えなさい。
. インタプリタが動作するようにプログラムを修正する。
. 動作を確認する。
** 実行できている様子のターミナルウィンドウのスナップショットを取得し「 <<lox_e_exec>> 」を差し替えなさい。
. 必要なcommitやpushを実施する。

[[lox_e_error]]
.`lox_e` のコードをコンパイルしたときのエラーメッセージのスナップショット
--
image::lox_e_error_snap.jpg[]
--


[[lox_e_exec]]
.`lox_e` の修正後に実行できている様子のスナップショット
--
image::lox_e_exec_snap.jpg[]
--

下記ブロックを編集して、エラーの原因とどの箇所をどのように修正すべきであったのかについての説明を書きなさい。 +
（ダミーテキストとして、記載すべき項目を箇条書きにしておいた）

.エラーの原因と修正内容についての説明
====
* どのようなエラーが起きているのか。
* エラーの原因はなにか。
* エラーの原因を取り除くために、どのような対処が必要か。
* その対処のためには、どのような修正を施せばよいのか。
====

IMPORTANT: 問6の回答に手を付けたなら、commitしておきなさい（後でやったり、修正した場合も同様）。 +
気になるなら、pushしておくのもよいだろう。


== 試験の提出

このAssignment（`cit-compiler-final-exam`）と、`lox01` 、 `lox_e` の各Assignmentについて、各々必要な commit を済ませたのちに push することで、試験を提出したとみなす。
pushされたこれらのリポジトリについて、試験時間内に実施したcommitまでが採点対象範囲となる。
